{% extends "ancestry/base.html" %}
{% load static %}

{% block title %}
Tree {{ tree.name }}
{% endblock %}

{% block css %}
<style>
    .linage {
        fill: none;
        stroke: black;
    }
    .marriage {
        fill: none;
        stroke: black;
    }
    .node {
        background-color: lightblue;
        border-style: solid;
        border-width: 1px;
    }
    .nodeText{
        font: 10px sans-serif;
    }
    .marriageNode {
        background-color: black;
        border-radius: 50%;
    }
</style>
{% endblock %}

{% block content %}
<h1>{{ tree.name }}</h1>
<div id="graph"></div>

{{ tree_data|json_script:"treeData" }}

<script src="https://cdn.jsdelivr.net/lodash/4.17.4/lodash.min.js"></script>
<script src="https://d3js.org/d3.v4.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/d3-dtree@2.4.1/dist/dTree.min.js"></script>
<script>
    const treeData = [JSON.parse(document.getElementById('treeData').textContent)];
    console.log(treeData)

    const testTreeData = [{
        "name": "p_gf",
        "class": "node",
        "textClass": "nodeText",
        "marriages": [{
            "spouse": {
                "name": "p_gm",
                "class": "node",
                "textClass": "nodeText"
            },
            "children": [{
                "name": "f",
                "class": "node",
                "textClass": "nodeText",
                "marriages": [{
                    "spouse": {
                        "name": "m",
                        "class": "node",
                        "textClass": "nodeText"
                    },
                    "children": [{
                        "name": "Test",
                        "class": "node",
                        "textClass": "nodeText",
                        "marriages": []
                    }]
                }]
            }]
        }]
    },{
        "name": "m_gp"
    }];

    tree = dTree.init(treeData,
        {
            target: "#graph",
            debug: true,
            hideMarriageNodes: true,
            marriageNodeSize: 5,
            height: 800,
            width: 1200,
            callbacks: {
                nodeClick: function(name, extra) {
                    alert('Click: ' + name);
                },
                nodeRightClick: function(name, extra) {
                    alert('Right-click: ' + name);
                },
                textRenderer: function(name, extra, textClass) {
                    if (extra && extra.nickname)
                        name = name + " (" + extra.nickname + ")";
                    return "<p align='center' class='" + textClass + "'>" + name + "</p>";
                },
                marriageClick: function(extra, id) {
                    alert('Clicked marriage node' + id);
                },
                marriageRightClick: function(extra, id) {
                    alert('Right-clicked marriage node' + id);
                },
            }
        });
</script>
{% endblock %}